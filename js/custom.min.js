d3.queue().defer(d3.csv,"processed/total_global_co_2.csv").defer(d3.csv,"processed/methane.csv").await(function(q,r,t){function J(a,d,e){var l=isNaN(e)?t:r;a=d3.select(a).append("svg");a.attr("height",w+b.top+b.bottom).attr("width",A+b.right+b.left).attr("class","carbon-dioxide").attr("id","graph_"+e);var c=d3.scaleTime().range([0,A]);c.domain(d3.extent(l,d3.f("date")));var h=d3.scaleSqrt().range([0,w]);h.domain([4150,0]);var g=d3.axisBottom().scale(c).ticks(8),f=d3.axisLeft().scale(h);a.append("g").attr("class",
    "axis x_"+e).translate([b.left,w+b.top]);d3.select("g.x_"+e).call(g);a.append("g").attr("class","axis y_"+e).translate([b.left,b.top]);d3.select("g.y_"+e).call(f);g=d3.line().curve(d3.curveNatural).x(function(a){return c(a.date)}).y(function(a){return h(a[d])});a.append("path#co"+e).translate([b.left,b.top]);d3.select("path#co"+e).transition().duration(1E3).ease(d3.easeSinInOut).attr("d",g(l));K(a,l,c,h)}function K(a,d,e,l){var c=a.append("g").attr("class","focus").style("display","none");c.append("circle").attr("class",
    "y0").attr("r",2.5);c.append("text").attr("class","y0").attr("x",9).attr("dy",".35em");a.append("rect").attr("class","overlay").attr("width",A).attr("height",w).on("mouseover touchstart",function(){d3.selectAll(".focus").style("display",null)}).on("mouseout touchend",function(){d3.selectAll(".focus").style("display","none")}).on("mousemove touchmove",function(){var a=e.invert(d3.mouse(this)[0]),c=L(d,a,1),k=d[c-1],c=d[c];void 0===c&&(c=Infinity);var n=a-k.date>c.date-a?c:k;f.forEach(function(a,d){var c=
    [e(n.date)+b.left,l(n[a])+b.top];d3.select("#graphed"+d+" circle.y0").translate(c);d3.select("#graphed"+d+" text.y0").translate(c).tspans(function(d){return["Emissions: "+B(n[a]),u(a,!1)+" ("+n.year+")"]},-15)})}).translate([b.left,b.top]);return a}function D(a,d,e){var b=window.innerWidth;console.log(b);var c=/month/.test(a),h,g;1090>b?(h=60,g="vertical"):(h=e?110:90,g="horizontal");e="vertical"===g&&e?130:"vertical"===g?240:75;c=1090>b||c?200:b-10;b=a.substr(1);a=d3.select(a).append("svg").classed("legend",
    !0).attr("width",c).attr("height",e);a.append("g").attr("class","legend-"+b).attr("width",c).translate([0,20]);d=d3.legendColor().shapeWidth(h).orient(g).labelFormat(d3.format(".01f")).scale(d);a.select(".legend-"+b).call(d);return a}function u(a,b){var d=a.split("_");return b||"flaring"!=d[1]?b?_.capitalize(d[0])+" "+_.capitalize(d[1]):_.capitalize(d[0]):_.capitalize(d[1])}var p=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),b={top:45,right:50,bottom:50,left:50},w=300-
    b.top-b.bottom,m=700-b.top-b.bottom,E=window.innerWidth-b.left-b.right,F=d3.timeParse("%Y"),B=d3.format(","),A=400-b.right-b.left,x=window.innerWidth-b.left-b.right,k=(x-300)/2;q=x/2;var y=430>x?8:15;r.forEach(function(a){a.date=F(a.year);a.total=+a.total;a.gas_fuel=+a.gas_fuel;a.liquid_fuel=+a.liquid_fuel;a.solid_fuel=+a.solid_fuel;a.cement_production=+a.cement_production;a.gas_flaring=+a.gas_flaring});t.forEach(function(a){a.date=F(a.year);a.mean=+a.mean});var L=d3.bisector(function(a){return a.date}).right,
    f=["solid_fuel","liquid_fuel","gas_fuel","cement_production","gas_flaring"],v=d3.scaleTime().range([0,E]);v.domain(d3.extent(r,d3.f("date")));var G=d3.scaleOrdinal().range(["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"].reverse()),z=d3.stack().keys(f).order(d3.stackOrderInsideOut).offset(d3.stackOffsetWiggle)(r),H=d3.scaleLinear().domain([0,d3.max(z,function(a){return d3.max(a,function(a){return a[0]+a[1]})})]).range([m,0]),M=d3.area().x(function(a){return v(a.data.date)}).y0(function(a){return H(a[0])}).y1(function(a){return H(a[1])}).curve(d3.curveBasis),
    N=d3.axisTop(v).ticks(y),y=d3.axisBottom(v).ticks(y),O=f.map(function(a){return u(a,!0)});D("#co-two-total-legend",G.domain(O),!0);m=d3.select("#co-two-total").append("svg").attr("width",E+b.left+b.right).attr("height",m+b.top+b.bottom).append("g").attr("class","svg").translate([0,-265]);m.selectAll("path").data(z).enter().append("path").attr("d",M).style("fill",function(a,b){return G(f[b])}).on("mouseover touchstart",function(a){d3.select(this).style("opacity",.81)}).on("mousemove touchmove",function(a, b){var d=v.invert(d3.mouse(this)[0]).getFullYear();console.log(d);var l=_.find(r,function(a){return a.year==d});p.transition().duration(100).style("opacity",.9);p.html('<h5 class="text-center">'+u(f[b],!0)+" ("+l.year+')</h5><ul class="list-unstyled"><li>Total Levels: '+B(l.total)+" mmt</li><li>"+u(f[b],!0)+" Levels: "+B(l[f[b]])+" mmt</li></ul>").style("top",d3.event.pageY-108+"px").style("left",d3.event.pageX-110+"px")}).on("mouseout touchend",function(a){d3.select(this).style("opacity",1);p.transition().duration(250).style("opacity",0)});m.append("g").attr("class","axis").translate([0,290]).call(N);m.append("g").attr("class","axis").translate([0,890]).call(y);f.forEach(function(a,b){d3.select("#co-two").append("div").attr("class","graph").attr("id","graphed"+b);d3.select("#graphed"+b).append("h4").attr("class","text-center").text(u(a,!0));J("#graphed"+b,a,b)});var z="#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" ").reverse(),I=d3.scaleQuantize().domain(d3.extent(t,d3.f("mean"))).range(z);
    D("#methane-legend",I,!1);var C=d3.scaleTime().range([0,300]);C.domain(d3.extent(t,d3.f("date")));(function(a,b,e){var d,c,h,g,f,n,m;void 0===e&&(d=80,c=100,g=110,h=C,f=I,n="mean",m="date");a=d3.select(a).append("svg").attr("width",x).attr("height",g).attr("class","svg").selectAll("bar").data(b);a.enter().append("rect").merge(a).attr("x",function(a){return h(a[m])}).attr("width",_.floor(300/b.length,3)).attr("y",0).attr("height",d).translate([k,0]).style("fill",function(a){return f(a[n])}).on("mouseover touchstart",
        function(a){d3.select(this).attr("height",c).style("fill","lightgray");p.transition().duration(100).style("opacity",.9);p.html('<h4 class="text-center">'+a.year+'</h4><ul class="list-unstyled"><li>Methane Levels: '+a.mean+" ppb</li></ul>").style("top",d3.event.pageY-88+"px").style("left",d3.event.pageX-25+"px")}).on("mouseout touchend",function(a){d3.select(this).attr("height",d).style("fill",function(a){return f(a[n])});p.transition().duration(250).style("opacity",0)});a.exit().remove();return a})("#methane",
            t);d3.selectAll("#co-two-total .annotations").translate([-(1.8*q),0]);(function(a,b,e,f){var c=d3.swoopyDrag().x(function(a){return e(a.xVal)}).y(function(a){return void 0!==f?f(a.yVal):a.yVal}).draggable(0);c.annotations(b);d3.select(a+" .svg").append("g.annotations").call(c)})("#methane",[{xVal:"1989",yVal:0,path:"M"+(k+200)+",94L"+(k+188)+",67",text:"Level passes 1,700 ppb",textOffset:[k+120,107]},{xVal:"2011",yVal:0,path:"M"+(k+380)+",95L"+(k+400)+",64",text:"Level passes 1,800 ppb",textOffset:[k+
        300,107]}],C);q=d3.selectAll(".row");q.classed("opaque",!1);q.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});