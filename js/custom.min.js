d3.queue().defer(d3.csv,"processed/total_global_co_2.csv").defer(d3.csv,"processed/methane.csv").await(function(g,p,k){function x(a,f,d){var h=isNaN(d)?k:p;a=d3.select(a).append("svg");a.attr("height",m+b.top+b.bottom).attr("width",q+b.right+b.left).attr("class","carbon-dioxide").attr("id","graph_"+d);var e=d3.scaleTime().range([0,q]);e.domain(d3.extent(h,d3.f("date")));var n=d3.scaleSqrt().range([0,m]);n.domain([4150,0]);var c=d3.axisBottom().scale(e).ticks(8),y=d3.axisLeft().scale(n);a.append("g").attr("class",
    "axis x_"+d).translate([b.left,m+b.top]);d3.select("g.x_"+d).call(c);a.append("g").attr("class","axis y_"+d).translate([b.left,b.top]);d3.select("g.y_"+d).call(y);c=d3.line().curve(d3.curveNatural).x(function(a){return e(a.date)}).y(function(a){return n(a[f])});a.append("path#co"+d).translate([b.left,b.top]);d3.select("path#co"+d).transition().duration(1E3).ease(d3.easeSinInOut).attr("d",c(h));z(a,h,e,n)}function z(a,f,d,h){var e=a.append("g").attr("class","focus").style("display","none");e.append("circle").attr("class",
    "y0").attr("r",2.5);e.append("text").attr("class","y0").attr("x",9).attr("dy",".35em");a.append("rect").attr("class","overlay").attr("width",q).attr("height",m).on("mouseover touchstart",function(){d3.selectAll(".focus").style("display",null)}).on("mouseout touchend",function(){d3.selectAll(".focus").style("display","none")}).on("mousemove touchmove",function(){var a=d.invert(d3.mouse(this)[0]),c=A(f,a,1),e=f[c-1],c=f[c];void 0===c&&(c=Infinity);var l=a-e.date>c.date-a?c:e;r.forEach(function(a,c){var f=
    [d(l.date)+b.left,h(l[a])+b.top];d3.select("#graphed"+c+" circle.y0").translate(f);d3.select("#graphed"+c+" text.y0").translate(f).tspans(function(b){return["Emissions: "+B(l[a]),u(a)+" ("+l.year+")"]},-15)})}).translate([b.left,b.top]);return a}function u(a){a=a.split("_");return _.capitalize(a[0])+" "+_.capitalize(a[1])}var t=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),b={top:45,right:52,bottom:50,left:45},m=300-b.top-b.bottom,v=d3.timeParse("%Y"),B=d3.format(",");
    g="#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" ").reverse();var C=d3.scaleQuantize().domain(d3.extent(k,d3.f("mean"))).range(g),q=400-b.right-b.left;p.forEach(function(a){a.date=v(a.year);a.total=+a.total;a.gas_fuel=+a.gas_fuel;a.liquid_fuel=+a.liquid_fuel;a.solid_fuel=+a.solid_fuel;a.cement_production=+a.cement_production;a.gas_flaring=+a.gas_flaring});k.forEach(function(a){a.date=v(a.year);a.mean=+a.mean});var A=d3.bisector(function(a){return a.date}).right,r=["solid_fuel","liquid_fuel","gas_fuel","cement_production","gas_flaring"];d3.stack().keys(r).order(d3.stackOrderNone).offset(d3.stackOffsetWiggle)(p);r.forEach(function(a,b){d3.select("#co-two").append("div").attr("class","graph").attr("id","graphed"+b);d3.select("#graphed"+b).append("h4").attr("class","text-center").text(u(a));x("#graphed"+b,a,b)});var w=d3.scaleTime().range([0,300]);w.domain(d3.extent(k,d3.f("date")));(function(a,f,d){var h,e,n,c,g,l,k;void 0===d&&(h=80,e=100,c=110,n=w,g=C,l="mean",k="date");var m=window.innerWidth-b.left-b.right;d=(m-300)/2;a=d3.select(a).append("svg").attr("width",m).attr("height",c).attr("class","svg").selectAll("bar").data(f);a.enter().append("rect").merge(a).attr("x",function(a){return n(a[k])}).attr("width",_.floor(300/f.length,3)).attr("y",0).attr("height",h).translate([d,0]).style("fill",function(a){return g(a[l])}).on("mouseover touchstart",function(a){d3.select(this).attr("height",e).style("fill","lightgray");t.transition().duration(100).style("opacity",.9);t.html('<h4 class="text-center">'+a.year+'</h4><ul class="list-unstyled"><li>Methane Levels: '+a.mean+" ppb</li></ul>").style("top",d3.event.pageY-88+"px").style("left",d3.event.pageX-25+"px")}).on("mouseout touchend",function(a){d3.select(this).attr("height",h).style("fill",function(a){return g(a[l])});t.transition().duration(250).style("opacity",0)});a.exit().remove();return a})("#methane",k);g=d3.selectAll(".row");g.classed("opaque",!1);g.classed("hide",!1);d3.selectAll("#load").classed("hide",!0)});